$(document).ready(function(){function t(){s=l.selectAll("circle").data(E,function(t){return t.ID}),s.enter().append("circle").attr("r",function(t){return t.radius}).style("fill",function(t){return t.color}).call(d.drag),s.exit().remove(),d.on("tick",function(t){s.each(e(.005)).each(a(.3)).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})}),d.start()}function e(t){return function(e,a){e.y+=(e.cy-e.y)*t,e.x+=(e.cx-e.x)*t}}function a(t){var e=d3.geom.quadtree(E);return function(a){var n=a.radius,r=a.x-n,o=a.x+n,i=a.y-n,s=a.y+n;e.visit(function(e,n,c,E,l){if(e.point&&e.point!==a){var d=a.x-e.point.x,u=a.y-e.point.y,h=Math.sqrt(d*d+u*u),N=a.radius+e.point.radius+(a.color!==e.point.color);h<N&&(h=(h-N)/h*t,a.x-=d*=h,a.y-=u*=h,e.point.x+=d,e.point.y+=u)}return n>o||E<r||c>s||l<i})}}function n(t){return t.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")}function r(){$("tr:visible").each(function(t,e){t%2?$(e).css("background-color","#f2f2f2"):$(e).css("background-color","#ffffff")})}var o=1e3,i=560,s=null,c=(d3.scale.ordinal().rangePoints([0,o],1),{"Latin America and the Caribbean":{x:300,y:380},Oceania:{x:840,y:450},"Northern America":{x:220,y:180},Europe:{x:500,y:190},Asia:{x:730,y:250},Africa:{x:510,y:320}}),E=expertsData.map(function(t,e){return t.radius=6,t.color="#FFAA00",t.cx=c[t.REGION].x,t.cy=c[t.REGION].y,t}),l=d3.select("#map-wrapper").append("svg").attr("width",o).attr("height",i).style("position","absolute"),d=d3.layout.force().nodes(E).size([o,i]).gravity(0).charge(0);t(),$(".filters1 .checkbox").on("change",function(){var e=this.value;if(this.checked){var a=d3.selectAll(".filters2 .checkbox:checked")[0].map(function(t){return t.value});expertsData.forEach(function(t){var n=!t["CONFERENCE 1 ATTENDED"]||a.indexOf(t["CONFERENCE 1 ATTENDED"])>=0,r=!t["CONFERENCE 2 ATTENDED"]||a.indexOf(t["CONFERENCE 2 ATTENDED"])>=0,o=!t["CONFERENCE 3 ATTENDED"]||a.indexOf(t["CONFERENCE 3 ATTENDED"])>=0;e===t["AFFILIATION 1"]&&n&&r&&o&&(delete t.x,delete t.px,delete t.y,delete t.py,E.push(t))}),$("tr."+n(e)).show(),r(),$(this).parent().removeClass("button--inactive"),$(this).parent().addClass("button--active")}else{var o=[];E.forEach(function(t){t["AFFILIATION 1"]!==e&&o.push(t)}),E=o,$("tr."+n(e)).hide(),r(),$(this).parent().removeClass("button--active"),$(this).parent().addClass("button--inactive")}t()}),$(".filters2 .checkbox").on("change",function(){var e=this.value;if(this.checked){var a=d3.selectAll(".filters1 .checkbox:checked")[0].map(function(t){return t.value});expertsData.forEach(function(t){var n=e===t["CONFERENCE 1 ATTENDED"],r=e===t["CONFERENCE 2 ATTENDED"],o=e===t["CONFERENCE 3 ATTENDED"],i=a.indexOf(t["AFFILIATION 1"])>=0;(n||r||o)&&i&&(delete t.x,delete t.px,delete t.y,delete t.py,E.push(t))}),$("tr."+n(e)).show(),r(),$(this).parent().removeClass("button--inactive"),$(this).parent().addClass("button--active")}else{var o=[];E.forEach(function(t){var a=t["CONFERENCE 1 ATTENDED"]!==e,n=t["CONFERENCE 2 ATTENDED"]!==e,r=t["CONFERENCE 3 ATTENDED"]!==e;a&&n&&r&&o.push(t)}),E=o,$("tr."+n(e)).hide(),r(),$(this).parent().removeClass("button--active"),$(this).parent().addClass("button--inactive")}t()}),expertsData.forEach(function(t){var e=$("<tr>"),a=[];e.data("name",n(t.NAME)),e.addClass(n(t["AFFILIATION 1"])),t["CONFERENCE 1 ATTENDED"]&&(e.addClass(n(t["CONFERENCE 1 ATTENDED"])),a.push(t["CONFERENCE 1 ATTENDED"])),t["CONFERENCE 2 ATTENDED"]&&(e.addClass(n(t["CONFERENCE 2 ATTENDED"])),a.push(t["CONFERENCE 2 ATTENDED"])),t["CONFERENCE 3 ATTENDED"]&&(e.addClass(n(t["CONFERENCE 3 ATTENDED"])),a.push(t["CONFERENCE 3 ATTENDED"])),e.append($("<td>")),e.append($("<td>").text(t.NAME).addClass("name-column")),e.append($("<td>").text(t["AFFILIATION 1"]).addClass("sector-column")),e.append($("<td>").text(a.join(", ")).addClass("topic-column")),$(".table-sortable").append(e)}),$(".js-open-table-search").click(function(t){$(this).parent().siblings(".table-sortable__search").toggleClass("table-sortable__search--active")});var u=$(".table-sortable__search").find("button[type='submit']");u.on("click",function(t){t.preventDefault(),$(this).parent().hasClass("table-sortable__search--active")&&($(this).parent().removeClass("table-sortable__search--active"),$(".search").val(""),$("tbody tr").show())}),$("body").keyup(function(t){"27"==t.keyCode&&($(this).parent().find(".table-sortable__search").removeClass("table-sortable__search--active"),$(".search").val(""),$("tbody tr").show())}),$("#expert__name--input").on("keyup",function(){var t=$(this).val();$("tbody tr").each(function(e,a){var n=$(a).data("name");n.indexOf(t)!==-1?$(a).show():$(a).hide()}),r()});var h=$(".table-sortable__control > i:contains('keyboard_arrow_down')");h.on("click",function(){"keyboard_arrow_down"==$(this).text()?$(this).text("keyboard_arrow_up"):$(this).text("keyboard_arrow_down")}),$("thead .sort").each(function(){var t=$(this).closest("th"),e=t.index(),a=!1;t.click(function(){$("table").find("td").filter(function(){return $(this).index()===e}).sortElements(function(t,e){return $.text([t])==$.text([e])?0:$.text([t])>$.text([e])?a?-1:1:a?1:-1},function(){return this.parentNode}),a=!a})})});