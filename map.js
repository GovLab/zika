$(document).ready(function(){function t(){E=u.selectAll("circle").data(d,function(t){return t.ID}),E.enter().append("circle").attr("r",function(t){return t.radius}).style("fill",function(t){return t.color}).call(h.drag),E.exit().remove(),h.on("tick",function(t){E.each(e(.005)).each(a(.3)).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})}),h.start()}function e(t){return function(e,a){e.y+=(e.cy-e.y)*t,e.x+=(e.cx-e.x)*t}}function a(t){var e=d3.geom.quadtree(d);return function(a){var n=a.radius,r=a.x-n,i=a.x+n,c=a.y-n,o=a.y+n;e.visit(function(e,n,s,E,l){if(e.point&&e.point!==a){var d=a.x-e.point.x,u=a.y-e.point.y,h=Math.sqrt(d*d+u*u),f=a.radius+e.point.radius+(a.color!==e.point.color);h<f&&(h=(h-f)/h*t,a.x-=d*=h,a.y-=u*=h,e.point.x+=d,e.point.y+=u)}return n>i||E<r||s>o||l<c})}}function n(t){return t.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")}function r(){$("tr:visible").each(function(t,e){t%2?$(e).css("background-color","#f2f2f2"):$(e).css("background-color","#ffffff")})}function i(){Object.keys(l).forEach(function(t,e){var a=d.filter(function(e){return e.REGION===t}).length;$(".dashboard__item."+n(t)+" span").text(a)})}function c(t){$("."+t+" .button--inactive").each(function(){$(this).removeClass("button--inactive"),$(this).addClass("button--active"),$(this).find(".checkbox").prop("checked",!0),$(this).find(".checkbox").trigger("change")})}var o=1e3,s=560,E=null,l=(d3.scale.ordinal().rangePoints([0,o],1),{"Latin America and the Caribbean":{x:300,y:380},Oceania:{x:840,y:450},"Northern America":{x:220,y:180},Europe:{x:500,y:190},Asia:{x:730,y:250},Africa:{x:510,y:320}}),d=expertsData.map(function(t,e){return t.radius=6,t.color="#FFAA00",t.cx=l[t.REGION].x,t.cy=l[t.REGION].y,t}),u=d3.select("#map-wrapper").append("svg").attr("width",o).attr("height",s).style("position","absolute"),h=d3.layout.force().nodes(d).size([o,s]).gravity(0).charge(0);t(),i(),$(".filters1 .checkbox").on("change",function(){var e=this.value;if(this.checked){var a=d3.selectAll(".filters2 .checkbox:checked")[0].map(function(t){return t.value});expertsData.forEach(function(t){var n=!t["CONFERENCE 1 ATTENDED"]||a.indexOf(t["CONFERENCE 1 ATTENDED"])>=0,r=!t["CONFERENCE 2 ATTENDED"]||a.indexOf(t["CONFERENCE 2 ATTENDED"])>=0,i=!t["CONFERENCE 3 ATTENDED"]||a.indexOf(t["CONFERENCE 3 ATTENDED"])>=0;e===t["AFFILIATION 1"]&&n&&r&&i&&(delete t.x,delete t.px,delete t.y,delete t.py,d.push(t))}),$("tr."+n(e)).show(),$(this).parent().removeClass("button--inactive"),$(this).parent().addClass("button--active")}else{var o=[];d.forEach(function(t){t["AFFILIATION 1"]!==e&&o.push(t)}),d=o,$("tr."+n(e)).hide(),$(this).parent().removeClass("button--active"),$(this).parent().addClass("button--inactive")}return 0===$(".filters1 .checkbox:checked").length?(c("filters1"),!1):(t(),i(),void r())}),$(".filters2 .checkbox").on("change",function(){var e=this.value;if(this.checked){var a=d3.selectAll(".filters1 .checkbox:checked")[0].map(function(t){return t.value}),o=d3.selectAll(".filters2 .checkbox:checked")[0].map(function(t){return t.value});expertsData.forEach(function(t){var n=e===t["CONFERENCE 1 ATTENDED"],r=e===t["CONFERENCE 2 ATTENDED"],i=e==t["CONFERENCE 3 ATTENDED"],c=!t["CONFERENCE 1 ATTENDED"]||o.indexOf(t["CONFERENCE 1 ATTENDED"])>=0,s=!t["CONFERENCE 2 ATTENDED"]||o.indexOf(t["CONFERENCE 2 ATTENDED"])>=0,E=!t["CONFERENCE 3 ATTENDED"]||o.indexOf(t["CONFERENCE 3 ATTENDED"])>=0,l=a.indexOf(t["AFFILIATION 1"])>=0;(n||r||i)&&c&&s&&E&&l&&(delete t.x,delete t.px,delete t.y,delete t.py,d.push(t))}),$("tr."+n(e)).show(),$(this).parent().removeClass("button--inactive"),$(this).parent().addClass("button--active")}else{var s=[];d.forEach(function(t){var a=t["CONFERENCE 1 ATTENDED"]!==e,n=t["CONFERENCE 2 ATTENDED"]!==e,r=t["CONFERENCE 3 ATTENDED"]!==e;a&&n&&r&&s.push(t)}),d=s,$("tr."+n(e)).hide(),$(this).parent().removeClass("button--active"),$(this).parent().addClass("button--inactive")}return 0===$(".filters2 .checkbox:checked").length?(c("filters2"),!1):(t(),i(),void r())}),$(".reset-filters1").click(function(){c("filters1")}),$(".reset-filters2").click(function(){c("filters2")}),expertsData.forEach(function(t){var e=$("<tr>"),a=[];e.data("name",n(t.NAME)),e.addClass(n(t["AFFILIATION 1"])),t["CONFERENCE 1 ATTENDED"]&&(e.addClass(n(t["CONFERENCE 1 ATTENDED"])),a.push(t["CONFERENCE 1 ATTENDED"])),t["CONFERENCE 2 ATTENDED"]&&(e.addClass(n(t["CONFERENCE 2 ATTENDED"])),a.push(t["CONFERENCE 2 ATTENDED"])),t["CONFERENCE 3 ATTENDED"]&&(e.addClass(n(t["CONFERENCE 3 ATTENDED"])),a.push(t["CONFERENCE 3 ATTENDED"])),e.append($("<td>")),e.append($("<td>").text(t.NAME).addClass("name-column")),e.append($("<td>").text(t["AFFILIATION 1"]).addClass("sector-column")),e.append($("<td>").text(a.join(", ")).addClass("topic-column")),e.append($("<td>").text(t.ORGANIZATION).addClass("organization-column")),$(".table-sortable").append(e)}),$(".js-open-table-search").click(function(t){$(this).parent().siblings(".table-sortable__search").toggleClass("table-sortable__search--active")});var f=$(".table-sortable__search").find("button[type='submit']");f.on("click",function(t){t.preventDefault(),$(this).parent().hasClass("table-sortable__search--active")&&($(this).parent().removeClass("table-sortable__search--active"),$(".search").val(""),$("tbody tr").show())}),$("body").keyup(function(t){"27"==t.keyCode&&($(this).parent().find(".table-sortable__search").removeClass("table-sortable__search--active"),$(".search").val(""),$("tbody tr").show())}),$("#expert__name--input").on("keyup",function(){var t=$(this).val();$("tbody tr").each(function(e,a){var n=$(a).data("name");n.indexOf(t)!==-1?$(a).show():$(a).hide()}),r()});var N=$(".table-sortable__control > i:contains('keyboard_arrow_down')");N.on("click",function(){"keyboard_arrow_down"==$(this).text()?$(this).text("keyboard_arrow_up"):$(this).text("keyboard_arrow_down")}),$("thead th").each(function(){var t=$(this).closest("th"),e=t.index(),a=!1;t.find(".sort").click(function(){$("table").find("td").filter(function(){return $(this).index()===e}).sortElements(function(t,e){return $.text([t])==$.text([e])?0:$.text([t])>$.text([e])?a?-1:1:a?1:-1},function(){return this.parentNode}),a=!a}),r()})});